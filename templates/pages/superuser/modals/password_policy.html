{# MODAL: POLÍTICAS DE CONTRASEÑA #}
<div class="modal fade" id="passwordPolicyModal" tabindex="-1" aria-labelledby="passwordPolicyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="passwordPolicyModalLabel">
                    <i class="fas fa-key me-2"></i>
                    Políticas de Contraseña
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="passwordPolicyForm">
                    {% csrf_token %}
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Configuración de Seguridad:</strong> Establezca las políticas de contraseña para todos los usuarios del sistema.
                            </div>
                        </div>
                        
                        {# Longitud de Contraseña #}
                        <div class="col-md-6">
                            <label for="min_length" class="form-label fw-bold">
                                <i class="fas fa-ruler me-2 text-warning"></i>Longitud Mínima
                            </label>
                            <input type="number" class="form-control" id="min_length" name="min_length" 
                                   value="8" min="4" max="50" required>
                            <div class="form-text">Mínimo de caracteres requeridos</div>
                        </div>
                        <div class="col-md-6">
                            <label for="max_length" class="form-label fw-bold">
                                <i class="fas fa-ruler me-2 text-warning"></i>Longitud Máxima
                            </label>
                            <input type="number" class="form-control" id="max_length" name="max_length" 
                                   value="128" min="8" max="256" required>
                            <div class="form-text">Máximo de caracteres permitidos</div>
                        </div>
                        
                        {# Requisitos de Caracteres #}
                        <div class="col-12">
                            <h6 class="fw-bold text-warning">
                                <i class="fas fa-check-circle me-2"></i>Requisitos de Caracteres
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="require_uppercase" 
                                       name="require_uppercase" checked>
                                <label class="form-check-label" for="require_uppercase">
                                    <i class="fas fa-font me-2"></i>Mayúsculas (A-Z)
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="require_lowercase" 
                                       name="require_lowercase" checked>
                                <label class="form-check-label" for="require_lowercase">
                                    <i class="fas fa-font me-2"></i>Minúsculas (a-z)
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="require_numbers" 
                                       name="require_numbers" checked>
                                <label class="form-check-label" for="require_numbers">
                                    <i class="fas fa-hashtag me-2"></i>Números (0-9)
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="require_special" 
                                       name="require_special">
                                <label class="form-check-label" for="require_special">
                                    <i class="fas fa-at me-2"></i>Caracteres Especiales (!@#$%)
                                </label>
                            </div>
                        </div>
                        
                        {# Configuraciones de Expiración #}
                        <div class="col-12">
                            <h6 class="fw-bold text-warning">
                                <i class="fas fa-clock me-2"></i>Expiración y Seguridad
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <label for="password_expiry" class="form-label fw-bold">
                                <i class="fas fa-calendar-alt me-2 text-warning"></i>Expiración (días)
                            </label>
                            <input type="number" class="form-control" id="password_expiry" name="password_expiry" 
                                   value="90" min="0" max="365">
                            <div class="form-text">0 = nunca expira</div>
                        </div>
                        <div class="col-md-6">
                            <label for="history_count" class="form-label fw-bold">
                                <i class="fas fa-history me-2 text-warning"></i>Historial de Contraseñas
                            </label>
                            <input type="number" class="form-control" id="history_count" name="history_count" 
                                   value="5" min="0" max="20">
                            <div class="form-text">Contraseñas anteriores a recordar</div>
                        </div>
                        
                        {# Configuraciones de Bloqueo #}
                        <div class="col-12">
                            <h6 class="fw-bold text-warning">
                                <i class="fas fa-shield-alt me-2"></i>Protección contra Ataques
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <label for="max_attempts" class="form-label fw-bold">
                                <i class="fas fa-exclamation-triangle me-2 text-warning"></i>Intentos Máximos
                            </label>
                            <input type="number" class="form-control" id="max_attempts" name="max_attempts" 
                                   value="5" min="3" max="10">
                            <div class="form-text">Intentos fallidos antes del bloqueo</div>
                        </div>
                        <div class="col-md-6">
                            <label for="lockout_duration" class="form-label fw-bold">
                                <i class="fas fa-lock me-2 text-warning"></i>Duración del Bloqueo (min)
                            </label>
                            <input type="number" class="form-control" id="lockout_duration" name="lockout_duration" 
                                   value="30" min="5" max="1440">
                            <div class="form-text">Tiempo de bloqueo en minutos</div>
                        </div>
                        
                        {# Configuraciones Adicionales #}
                        <div class="col-12">
                            <h6 class="fw-bold text-warning">
                                <i class="fas fa-cogs me-2"></i>Configuraciones Adicionales
                            </h6>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="force_change_first_login" 
                                       name="force_change_first_login" checked>
                                <label class="form-check-label" for="force_change_first_login">
                                    <i class="fas fa-user-shield me-2"></i>Forzar cambio en el primer inicio de sesión
                                </label>
                            </div>
                        </div>
                        
                        {# Vista Previa de la Política #}
                        <div class="col-12">
                            <div class="card bg-light">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-eye me-2"></i>Vista Previa de la Política
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="policyPreview" class="small">
                                        <p><strong>Las contraseñas deben:</strong></p>
                                        <ul id="policyList">
                                            <li>Tener entre 8 y 128 caracteres</li>
                                            <li>Incluir al menos una mayúscula</li>
                                            <li>Incluir al menos una minúscula</li>
                                            <li>Incluir al menos un número</li>
                                            <li>Cambiar cada 90 días</li>
                                            <li>No repetir las últimas 5 contraseñas</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-warning" onclick="savePasswordPolicy()">
                    <i class="fas fa-save me-2"></i>Guardar Políticas
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Actualizar vista previa en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('#passwordPolicyForm input');
    inputs.forEach(input => {
        input.addEventListener('change', updatePolicyPreview);
        input.addEventListener('input', updatePolicyPreview);
    });
    
    updatePolicyPreview();
});

function updatePolicyPreview() {
    const minLength = document.getElementById('min_length').value;
    const maxLength = document.getElementById('max_length').value;
    const requireUpper = document.getElementById('require_uppercase').checked;
    const requireLower = document.getElementById('require_lowercase').checked;
    const requireNumbers = document.getElementById('require_numbers').checked;
    const requireSpecial = document.getElementById('require_special').checked;
    const expiry = document.getElementById('password_expiry').value;
    const history = document.getElementById('history_count').value;
    
    let policyText = [];
    
    policyText.push(`Tener entre ${minLength} y ${maxLength} caracteres`);
    
    if (requireUpper) policyText.push('Incluir al menos una mayúscula');
    if (requireLower) policyText.push('Incluir al menos una minúscula');
    if (requireNumbers) policyText.push('Incluir al menos un número');
    if (requireSpecial) policyText.push('Incluir caracteres especiales (!@#$%)');
    
    if (expiry > 0) policyText.push(`Cambiar cada ${expiry} días`);
    if (history > 0) policyText.push(`No repetir las últimas ${history} contraseñas`);
    
    const policyList = document.getElementById('policyList');
    policyList.innerHTML = policyText.map(text => `<li>${text}</li>`).join('');
}
</script>